# Sistema de Alquiler de Autos

Sistema de gesti√≥n de alquiler de veh√≠culos desarrollado con arquitectura en capas para C# .NET.

## Descripci√≥n del Sistema

Sistema integral para la gesti√≥n de alquiler de veh√≠culos que permite:

- **Gesti√≥n de Clientes**: Alta, baja, modificaci√≥n y consulta de clientes
- **Gesti√≥n de Veh√≠culos**: Administraci√≥n del parque automotor disponible
- **Gesti√≥n de Categor√≠as**: Diferentes categor√≠as de veh√≠culos con precios diferenciados
- **Gesti√≥n de Sucursales**: M√∫ltiples ubicaciones para retiro y devoluci√≥n
- **Gesti√≥n de Alquileres**: Control completo del proceso de alquiler y devoluci√≥n

## Arquitectura

El sistema est√° desarrollado con **arquitectura en capas**:

### 1. Capa de Entidades (Entity)
- **Proyecto**: `SistemaAlquilerAutos.Entity`
- **Responsabilidad**: Definici√≥n de las entidades del dominio
- **Entidades**:
  - `Cliente`: Informaci√≥n de clientes
  - `Vehiculo`: Datos de los veh√≠culos
  - `Categoria`: Categor√≠as de veh√≠culos
  - `Sucursal`: Sucursales de la empresa
  - `Alquiler`: Registros de alquileres

### 2. Capa de Mapeo (Mapper)
- **Proyecto**: `SistemaAlquilerAutos.Mapper`
- **Responsabilidad**: Conversi√≥n de DataRow a objetos de negocio
- **Clases**:
  - `ClienteMapper`
  - `VehiculoMapper`
  - `CategoriaMapper`
  - `SucursalMapper`
  - `AlquilerMapper`

### 3. Capa de Acceso a Datos (DAL - Data Access Layer)
- **Proyecto**: `SistemaAlquilerAutos.DAL`
- **Responsabilidad**: Comunicaci√≥n con la base de datos
- **Componentes**:
  - `DatabaseHelper`: Clase utilitaria para operaciones de BD
  - `TransactionManager`: Manejo de transacciones
  - Clases DAL por entidad (ClienteDAL, VehiculoDAL, etc.)
- **Caracter√≠sticas**:
  - Uso de SqlParameters para prevenir SQL Injection
  - Manejo de transacciones
  - Liberaci√≥n correcta de recursos con `using`

### 4. Capa de L√≥gica de Negocio (BLL - Business Logic Layer)
- **Proyecto**: `SistemaAlquilerAutos.BLL`
- **Responsabilidad**: Implementaci√≥n de reglas de negocio
- **Reglas de Negocio Implementadas**:
  - Validaci√≥n de edad m√≠nima para clientes (18 a√±os)
  - Validaci√≥n de formato de DNI y patentes
  - Verificaci√≥n de duplicados (DNI, Patente)
  - Control de disponibilidad de veh√≠culos
  - C√°lculo autom√°tico de precios con descuentos por volumen:
    - 5% descuento: 7-14 d√≠as
    - 10% descuento: 15-29 d√≠as
    - 15% descuento: 30+ d√≠as
  - Control de alquileres activos
  - Validaci√≥n de fechas y kilometrajes
- **Excepciones Personalizadas**:
  - `BusinessException`: Base para excepciones de negocio
  - `BusinessRuleException`: Violaci√≥n de reglas de negocio
  - `EntityNotFoundException`: Entidad no encontrada
  - `DuplicateEntityException`: Entidad duplicada

### 5. Capa de Presentaci√≥n (UI)
- **Proyecto**: `SistemaAlquilerAutos.UI`
- **Tecnolog√≠a**: Windows Forms (.NET 6)
- **Formularios**:
  - `FormPrincipal`: Formulario principal con men√∫ MDI
  - `FormClientes`: Gesti√≥n de clientes
  - `FormEditarCliente`: Alta/modificaci√≥n de clientes
  - `FormVehiculos`: Gesti√≥n de veh√≠culos
  - `FormCategorias`: Gesti√≥n de categor√≠as
  - `FormSucursales`: Gesti√≥n de sucursales
  - `FormAlquileresActivos`: Visualizaci√≥n de alquileres activos
  - `FormHistorialAlquileres`: Historial completo
  - `FormNuevoAlquiler`: Creaci√≥n de alquileres (en desarrollo)
  - `FormDevolverVehiculo`: Devoluci√≥n de veh√≠culos (en desarrollo)

## Base de Datos

### Diagrama Entidad-Relaci√≥n

Ver archivo: [`Database/DiagramaER.md`](Database/DiagramaER.md)

### Tablas

1. **Categorias**
   - Id (PK)
   - Nombre, Descripcion, PrecioDiario
   - Activo

2. **Sucursales**
   - Id (PK)
   - Nombre, Direccion, Ciudad, Telefono, Email
   - Activo

3. **Vehiculos**
   - Id (PK)
   - Marca, Modelo, Anio, Patente (UNIQUE), Color, Kilometraje
   - Estado (Disponible/Alquilado/Mantenimiento/Inactivo)
   - CategoriaId (FK), SucursalId (FK)

4. **Clientes**
   - Id (PK)
   - DNI (UNIQUE), Nombre, Apellido, Email, Telefono
   - FechaNacimiento, Direccion, Ciudad
   - Activo

5. **Alquileres**
   - Id (PK)
   - ClienteId (FK), VehiculoId (FK)
   - FechaInicio, FechaFin, FechaDevolucionPrevista
   - SucursalRetiroId (FK), SucursalDevolucionId (FK)
   - KilometrajeInicio, KilometrajeFin
   - PrecioTotal, Estado, Observaciones

### Scripts SQL

Los scripts SQL est√°n en la carpeta `Database/`:

1. `00_MasterScript.sql`: Script maestro que ejecuta todos los dem√°s
2. `01_CreateDatabase.sql`: Creaci√≥n de la base de datos
3. `02_CreateTables.sql`: Creaci√≥n de tablas con constraints
4. `03_CreateIndexes.sql`: Creaci√≥n de √≠ndices
5. `04_InsertInitialData.sql`: Datos iniciales de prueba

## Instalaci√≥n y Configuraci√≥n

### Requisitos Previos

- .NET 6 SDK o superior
- SQL Server 2019 o superior (o SQL Server Express)
- Visual Studio 2022 (recomendado) o Visual Studio Code

### Pasos de Instalaci√≥n

1. **Clonar el repositorio**
   ```bash
   git clone <url-repositorio>
   cd Tp-Lug
   ```

2. **Crear la base de datos**
   - Abrir SQL Server Management Studio
   - Conectarse a la instancia de SQL Server
   - Ejecutar el script `Database/00_MasterScript.sql`
   - Alternativamente, ejecutar los scripts en orden (01, 02, 03, 04)

3. **Configurar la cadena de conexi√≥n**
   - Abrir el archivo `SistemaAlquilerAutos.UI/App.config`
   - Modificar la cadena de conexi√≥n seg√∫n su configuraci√≥n:
     ```xml
     <connectionStrings>
       <add name="SistemaAlquilerAutos"
            connectionString="Data Source=localhost;Initial Catalog=SistemaAlquilerAutos;Integrated Security=True;TrustServerCertificate=True"
            providerName="System.Data.SqlClient" />
     </connectionStrings>
     ```
   - Para SQL Server Express: `Data Source=.\SQLEXPRESS;...`
   - Para autenticaci√≥n SQL: Agregar `User ID=sa;Password=TuPassword;`

4. **Compilar la soluci√≥n**
   ```bash
   dotnet build
   ```

5. **Ejecutar la aplicaci√≥n**
   ```bash
   dotnet run --project SistemaAlquilerAutos.UI
   ```

## Uso del Sistema

### Inicio

Al iniciar el sistema, se presenta el formulario principal con un men√∫ que permite acceder a todas las funcionalidades.

### Gesti√≥n de Clientes

1. Ir a **Gesti√≥n ‚Üí Clientes**
2. Opciones disponibles:
   - **Buscar**: Buscar por nombre, apellido o DNI
   - **Nuevo Cliente**: Agregar un nuevo cliente
   - **Editar**: Modificar datos de un cliente existente
   - **Eliminar**: Dar de baja un cliente (soft delete)

### Gesti√≥n de Veh√≠culos

1. Ir a **Gesti√≥n ‚Üí Veh√≠culos**
2. Visualizar todos los veh√≠culos con su estado actual
3. Ver informaci√≥n de categor√≠a y sucursal asignada

### Crear un Alquiler (En desarrollo - Etapa Inicial)

1. Ir a **Alquileres ‚Üí Nuevo Alquiler**
2. Seleccionar cliente
3. Seleccionar veh√≠culo disponible
4. Definir fechas de retiro y devoluci√≥n
5. El sistema calcular√° autom√°ticamente el precio con descuentos

### Consultar Alquileres

- **Alquileres Activos**: Ver todos los alquileres en curso
- **Historial**: Ver todos los alquileres (activos, completados, cancelados)

## Caracter√≠sticas T√©cnicas Destacadas

### Transacciones

Todas las operaciones que modifican m√∫ltiples tablas utilizan transacciones:
- Creaci√≥n de alquiler: Inserta alquiler + actualiza estado del veh√≠culo
- Finalizaci√≥n de alquiler: Actualiza alquiler + actualiza veh√≠culo
- Cancelaci√≥n de alquiler: Cancela alquiler + libera veh√≠culo

Ejemplo de rollback autom√°tico en caso de error:
```csharp
using (var transaction = new TransactionManager())
{
    try
    {
        // Operaciones
        _alquilerDAL.Insert(alquiler, transaction);
        _vehiculoDAL.UpdateEstado(vehiculoId, EstadoAlquilado, transaction);

        transaction.Commit(); // Todo OK
    }
    catch
    {
        transaction.Rollback(); // Revertir en caso de error
        throw;
    }
}
```

### Validaciones

- **Nivel de Datos**: Constraints en base de datos
- **Nivel de Negocio**: Validaciones en capa BLL
- **Nivel de Presentaci√≥n**: Validaciones en formularios

### Seguridad

- **SQL Injection**: Prevenci√≥n mediante SqlParameters
- **Validaci√≥n de Datos**: Todas las entradas son validadas
- **Manejo de Errores**: Try-catch en todas las capas

## Estado del Proyecto

**Etapa Actual**: Inicial

### Completado ‚úÖ

- ‚úÖ Arquitectura en capas completa
- ‚úÖ Base de datos con 5 tablas relacionadas
- ‚úÖ Capa Entity con todas las entidades
- ‚úÖ Capa Mapper completa
- ‚úÖ Capa DAL con CRUD completo
- ‚úÖ Capa BLL con reglas de negocio
- ‚úÖ Manejo de transacciones
- ‚úÖ Manejo de excepciones personalizadas
- ‚úÖ Formularios principales de UI
- ‚úÖ Gesti√≥n de Clientes (completa)
- ‚úÖ Visualizaci√≥n de Categor√≠as, Sucursales, Veh√≠culos
- ‚úÖ Visualizaci√≥n de Alquileres
- ‚úÖ Scripts SQL completos
- ‚úÖ Datos iniciales de prueba
- ‚úÖ Archivo de configuraci√≥n (App.config)

### En Desarrollo üöß

- üöß Formularios de edici√≥n de Veh√≠culos
- üöß Formularios de edici√≥n de Categor√≠as
- üöß Formularios de edici√≥n de Sucursales
- üöß Formulario de Nuevo Alquiler
- üöß Formulario de Devoluci√≥n de Veh√≠culo

### Pendiente para Etapa Parcial üìã

- Integraci√≥n completa con base de datos
- Pruebas exhaustivas de transacciones
- Reportes y estad√≠sticas
- Validaci√≥n de reglas de negocio adicionales
- B√∫squedas avanzadas
- Filtros en listados

### Pendiente para Etapa Final üìã

- Manejo completo de transacciones de negocio
- Auditor√≠a de operaciones
- Backup y restore
- Exportaci√≥n de datos
- Manual de usuario completo
- Diagramas de clases
- Documentaci√≥n t√©cnica completa

## Tecnolog√≠as Utilizadas

- **Lenguaje**: C# 10
- **Framework**: .NET 6
- **UI**: Windows Forms
- **Base de Datos**: SQL Server 2019+
- **ADO.NET**: Para acceso a datos
- **Control de Versiones**: Git

## Estructura del Proyecto

```
Tp-Lug/
‚îú‚îÄ‚îÄ Database/
‚îÇ   ‚îú‚îÄ‚îÄ 00_MasterScript.sql
‚îÇ   ‚îú‚îÄ‚îÄ 01_CreateDatabase.sql
‚îÇ   ‚îú‚îÄ‚îÄ 02_CreateTables.sql
‚îÇ   ‚îú‚îÄ‚îÄ 03_CreateIndexes.sql
‚îÇ   ‚îú‚îÄ‚îÄ 04_InsertInitialData.sql
‚îÇ   ‚îî‚îÄ‚îÄ DiagramaER.md
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.Entity/
‚îÇ   ‚îú‚îÄ‚îÄ Alquiler.cs
‚îÇ   ‚îú‚îÄ‚îÄ Categoria.cs
‚îÇ   ‚îú‚îÄ‚îÄ Cliente.cs
‚îÇ   ‚îú‚îÄ‚îÄ Sucursal.cs
‚îÇ   ‚îî‚îÄ‚îÄ Vehiculo.cs
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.Mapper/
‚îÇ   ‚îú‚îÄ‚îÄ AlquilerMapper.cs
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaMapper.cs
‚îÇ   ‚îú‚îÄ‚îÄ ClienteMapper.cs
‚îÇ   ‚îú‚îÄ‚îÄ SucursalMapper.cs
‚îÇ   ‚îî‚îÄ‚îÄ VehiculoMapper.cs
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.DAL/
‚îÇ   ‚îú‚îÄ‚îÄ AlquilerDAL.cs
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaDAL.cs
‚îÇ   ‚îú‚îÄ‚îÄ ClienteDAL.cs
‚îÇ   ‚îú‚îÄ‚îÄ DatabaseHelper.cs
‚îÇ   ‚îú‚îÄ‚îÄ SucursalDAL.cs
‚îÇ   ‚îú‚îÄ‚îÄ TransactionManager.cs
‚îÇ   ‚îî‚îÄ‚îÄ VehiculoDAL.cs
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.BLL/
‚îÇ   ‚îú‚îÄ‚îÄ AlquilerBLL.cs
‚îÇ   ‚îú‚îÄ‚îÄ CategoriaBLL.cs
‚îÇ   ‚îú‚îÄ‚îÄ ClienteBLL.cs
‚îÇ   ‚îú‚îÄ‚îÄ SucursalBLL.cs
‚îÇ   ‚îú‚îÄ‚îÄ VehiculoBLL.cs
‚îÇ   ‚îî‚îÄ‚îÄ Exceptions/
‚îÇ       ‚îî‚îÄ‚îÄ BusinessException.cs
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.UI/
‚îÇ   ‚îú‚îÄ‚îÄ Program.cs
‚îÇ   ‚îú‚îÄ‚îÄ FormPrincipal.cs
‚îÇ   ‚îú‚îÄ‚îÄ App.config
‚îÇ   ‚îî‚îÄ‚îÄ Forms/
‚îÇ       ‚îú‚îÄ‚îÄ FormClientes.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormEditarCliente.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormVehiculos.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormCategorias.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormSucursales.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormNuevoAlquiler.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormAlquileresActivos.cs
‚îÇ       ‚îú‚îÄ‚îÄ FormHistorialAlquileres.cs
‚îÇ       ‚îî‚îÄ‚îÄ FormDevolverVehiculo.cs
‚îú‚îÄ‚îÄ SistemaAlquilerAutos.sln
‚îî‚îÄ‚îÄ README.md
```

## Autor

Trabajo Integrador - Laboratorio de Programaci√≥n

## Licencia

Este proyecto es con fines educativos.
